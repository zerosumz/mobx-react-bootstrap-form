import{action,computed,observable}from"mobx";import React from"react";import PropTypes from"prop-types";import{FormControl}from"react-bootstrap";import{observer}from"mobx-react";var _class,_temp,_dec,_class$1,_descriptor,_descriptor2,_descriptor3,classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},Validation=(_temp=_class=function(){function e(t,r){classCallCheck(this,e),this.rule=null,this.message=null,this.rule=t,this.message=r}return createClass(e,[{key:"isValid",value:function(e){return this.rule instanceof RegExp&&!this.rule.test(e)||this.rule instanceof Function&&!this.rule(e)}}]),e}(),_class.EMAIL_REGEX=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,_class.REQUIRED_REGEX=/^.+$/,_temp);function _initDefineProp(e,t,r,o){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(o):void 0})}function _applyDecoratedDescriptor(e,t,r,o,a){var i={};return Object.keys(o).forEach(function(e){i[e]=o[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,o){return o(e,t,r)||r},i),a&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(a):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var _class$2,FormStore=(_dec=action.bound,_class$1=function(){function e(){classCallCheck(this,e),_initDefineProp(this,"valueMap",_descriptor,this),_initDefineProp(this,"hasTried",_descriptor2,this),this.validationMap=new Map,_initDefineProp(this,"refs",_descriptor3,this)}return createClass(e,[{key:"clear",value:function(){this.hasTried.clear(),this.valueMap.clear()}},{key:"getErrorMessages",value:function(e){return this.errorMessagesMap.get(e)||[]}},{key:"invalidationsMap",get:function(){var e=this,t=new Map;return this.valueMap.forEach(function(r,o){var a=(e.validationMap.get(o)||[]).filter(function(e){return e.isValid(r)});a&&a.length>0&&t.set(o,a)}),t}},{key:"firstErrorMessage",get:function(){var e=[].concat(toConsumableArray(this.invalidationsMap.entries()))[0],t=void 0;return e&&e.length>1&&(t=e[1]),e&&t[0]?t[0].message:null}},{key:"firstInvalidRef",get:function(){var e=[].concat(toConsumableArray(this.invalidationsMap.entries()))[0];if(e&&e.length>1){var t=e[0];return this.refs.get(t)}}},{key:"valid",get:function(){return 0===this.invalidationsMap.size}},{key:"errorMessagesMap",get:function(){var e=new Map;return this.invalidationsMap.forEach(function(t,r){e.set(r,t.map(function(e){return e.message}))}),e}}]),e}(),_descriptor=_applyDecoratedDescriptor(_class$1.prototype,"valueMap",[observable],{enumerable:!0,initializer:function(){return new Map}}),_descriptor2=_applyDecoratedDescriptor(_class$1.prototype,"hasTried",[observable],{enumerable:!0,initializer:function(){return new Map}}),_descriptor3=_applyDecoratedDescriptor(_class$1.prototype,"refs",[observable],{enumerable:!0,initializer:function(){return new Map}}),_applyDecoratedDescriptor(_class$1.prototype,"clear",[_dec],Object.getOwnPropertyDescriptor(_class$1.prototype,"clear"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"invalidationsMap",[computed],Object.getOwnPropertyDescriptor(_class$1.prototype,"invalidationsMap"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"firstErrorMessage",[computed],Object.getOwnPropertyDescriptor(_class$1.prototype,"firstErrorMessage"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"firstInvalidRef",[computed],Object.getOwnPropertyDescriptor(_class$1.prototype,"firstInvalidRef"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"valid",[computed],Object.getOwnPropertyDescriptor(_class$1.prototype,"valid"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"errorMessagesMap",[computed],Object.getOwnPropertyDescriptor(_class$1.prototype,"errorMessagesMap"),_class$1.prototype),_class$1),omit=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];var a=Object.assign({},e);return r.forEach(function(e){return delete a[e]}),a},Input=observer(_class$2=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.store,r=e.name,o=e.value,a=e.validations;t.validationMap.set(r,a),t.valueMap.set(r,o||"")}},{key:"render",value:function(){var e=this.props,t=e.store,r=e.name,o=e.validOnBlur,a=e.onChange;return React.createElement(FormControl,_extends({inputRef:function(e){return t.refs.set(r,e)},value:t.valueMap.get(r),onChange:function(e){t.valueMap.set(r,e.target.value||""),a&&a(e)},onBlur:o?function(){return t.hasTried.set(r,!0)}:void 0},omit(this.props,"store","value","validations","validOnBlur","onChange")))}}]),t}(React.Component))||_class$2;Input.propTypes={store:PropTypes.object.isRequired,name:PropTypes.string.isRequired,value:PropTypes.any,validations:PropTypes.arrayOf(PropTypes.instanceOf(Validation))};export{Validation,FormStore,Input};
//# sourceMappingURL=index.js.map
